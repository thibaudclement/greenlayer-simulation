# Green Layer Simulation

This repository contains the synthetic data simulation code used in the Green Layer research project to evaluate the energy savings potential of network node sleeping strategies versus hardware upgrades. Full project documentation and analysis are published at [research.greenlayer.net/synthetic-data-simulation](https://research.greenlayer.net/synthetic-data-simulation/).

---

## Workflow

1. Generate traffic profile

Run `make_weekly_profile.py` to produce a synthetic weekly profile (`in/traffic_profile_us.csv`):

```
python3 make_weekly_profile.py
```

The profile contains hourly values for residential (`res`) and business (`biz`) demand, normalized to `[0,1]`.

2. Run the simulator

Run `simulate.py` to simulate both sleep-cap sweeps and hardware upgrade sweeps: 

```
python3 simulate.py \
--days 7 \
--tick-min 5 \
--topology scale_free \
--policy adaptive \
--pairs 160 \
--guard-mode adaptive \
--rho-target 0.60 \
--headroom 1.20 \
--spine-frac 0.18 \
--res-share 0.85 \
--heavy-user-share 0.015 \
--emit-timeseries \
--log-progress
```

See [Experiment Parameters](https://research.greenlayer.net/synthetic-data-simulation/#experiment-parameters) for the parameter set used in the published results.

Results are written to the `out/` folder as CSVs and JSONs.

3. Compute equivalence

Run `equivalence.py` to map energy savings from sleep policies to the equivalent hardware upgrade percentage:

```
python3 equivalence.py
```

Produces `out/equivalence.csv` with columns:

- `sleep_cap` : % of nodes allowed to sleep  
- `saving_pct` : % energy savings vs baseline  
- `equiv_upgrade_pct` : Upgrade % that yields the same energy consumption  

---

## Inputs & Outputs

### Inputs

- `in/traffic_profile_us.csv` includes hourly normalized residential and business demand, generated by `make_weekly_profile.py`.

- (Optional) `--event-csv` defines temporary demand multipliers (columns: `start_hour`, `duration_hours`, `multiplier`).

- (Optional) `--trace-csv` replaces the synthetic weekly profile, if provided, for realistic per-tick traffic trace (columns: `time_bin`, `src`, `dst`, `gbits`).

### Outputs

- `chart1–3_sleep_*.csv` include energy, latency, and drops as a function of the percentage of nodes allowed to sleep.

- `chart4–6_upgrade_*.csv` include energy, latency, and drops as a function of the percentage of nodes upgraded.

- Per-run summaries:
    - `ops_sleep_{pct}.json` present operational metrics (p95 rho, p95 queue, node flaps, etc.).  
    - `run_summary.json` are  CLI args and notes for reproducibility.

- `equivalence.csv` maps between node sleeping and equivalent upgrade percentages.

- (Optional) `timeseries_sleep_{pct}.csv` present per-tick timeseries (energy, sleeping nodes, alive capacity fraction).
